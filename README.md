# Wake-Lean-Engine

由于 leancloud 的免费云服务开启了流控，在半小时内没有请求就会进入休眠。每当有请求时才会再次启动，如果一个用户的请求正好遇到了休眠状态，这个用户收到响应的时间长达 2~10 秒，直到半个小时没有请求后则进入休眠，本程序的目的就是压榨服务器的工作时间

## 原理

利用定时函数发送 GET，发送请求时也对自己发送一次请求，达到双方都唤醒的目的，但是 leancloud 的免费服务器只能运行 18 小时，所以部署两个服务器互相倒班唤醒即可

## 使用方式

1. 创建两个应用
2. 设置环境变量
3. 拉取源码仓库部署

必须的环境变量：

+ `WAKE1`：唤醒服务器域名（打工仔），打工时间：`12:00`~`23:59`，总结`12`个小时
+ `WAKE2`：唤醒服务器域名（另一个打工仔），打工时间：`23:00`~第二天`12:59`，总计`12`个小时
+ `CALL_URLS`：被持续唤醒的服务器域名，可以设置多个，以`;`分隔，唤醒时长：`8:00`~第二天`1:59`，总计`18`个小时

可选的环境变量：

+ `START_HOUR`：被持续唤醒的服务器开始时刻，默认`8`，与结束时刻相差应不大于 18 个小时
+ `END_HOUR`：被持续唤醒的服务器结束时刻，默认`2`，与开始时刻相差应不大于 18 个小时
+ `INTERVAL_TIME`：控制唤醒时间，默认`60000`ms = 1 分钟
+ `LOG`：是否打印唤醒信息，默认打印，填入`0`后不打印

其中两个应用的`WAKE1`和`WAKE2`的值必须是相同的顺序，否则会造成唤醒错乱
